groups:
  - name: jetson_alerts
    interval: 10s
    rules:
      - alert: HighTemperature
        expr: jetson_cpu_temp_c > ${TEMP_THRESHOLD:-80}
        for: ${TEMP_DURATION:-2m}
        labels:
          severity: critical
          alert_type: temperature
        annotations:
          summary: "High CPU Temperature on {{ .instance }}"
          description: "Hey Wisevision team, the CPU has surpassed ${TEMP_THRESHOLD:-80}°C for ${TEMP_DURATION:-2 minutes}. Current temperature: {{  }}°C"

      - alert: HighGPUUsage
        expr: jetson_gpu_load_percent > ${GPU_THRESHOLD:-95}
        for: ${GPU_DURATION:-1m}
        labels:
          severity: critical
          alert_type: gpu
        annotations:
          summary: "High GPU Usage on {{ .instance }}"
          description: "Hey Wisevision team, the GPU has surpassed ${GPU_THRESHOLD:-95}% for ${GPU_DURATION:-1 minute}. Current usage: {{  }}%"

      - alert: LowAvailableRAM
        expr: (jetson_ram_total_mb - jetson_ram_used_mb) < ${RAM_AVAILABLE_THRESHOLD:-800}
        for: ${RAM_AVAILABLE_DURATION:-30s}
        labels:
          severity: critical
        annotations:
          summary: "Low Available RAM on {{ .instance }}"
          description: "Available RAM is only {{  }} MB"

      - alert: HighRAMUsage
        expr: jetson_ram_used_mb > ${RAM_THRESHOLD_MB:-13312}
        for: ${RAM_DURATION:-1m}
        labels:
          severity: critical
          alert_type: ram
        annotations:
          summary: "High RAM Usage on {{ .instance }}"
          description: "Hey Wisevision team, the RAM has surpassed ${RAM_THRESHOLD_GB:-13}GB. Current usage: {{  }} MB"

      - alert: CPUCoreImbalance
        expr: jetson_cpu_core0_percent > ${CPU_CORE_THRESHOLD:-95} or jetson_cpu_core1_percent > ${CPU_CORE_THRESHOLD:-95} or jetson_cpu_core2_percent > ${CPU_CORE_THRESHOLD:-95} or jetson_cpu_core3_percent > ${CPU_CORE_THRESHOLD:-95} or jetson_cpu_core4_percent > ${CPU_CORE_THRESHOLD:-95} or jetson_cpu_core5_percent > ${CPU_CORE_THRESHOLD:-95} or jetson_cpu_core6_percent > ${CPU_CORE_THRESHOLD:-95} or jetson_cpu_core7_percent > ${CPU_CORE_THRESHOLD:-95}
        for: ${CPU_CORE_DURATION:-1m}
        labels:
          severity: critical
          alert_type: cpu
        annotations:
          summary: "CPU Core Imbalance on {{ .instance }}"
          description: "Hey Wisevision team, the CPU has surpassed ${CPU_CORE_THRESHOLD:-95}% for ${CPU_CORE_DURATION:-1 minute}. Current value: {{  }}%"

      - alert: GPUIdle
        expr: jetson_gpu_load_percent < ${GPU_IDLE_THRESHOLD:-5}
        for: ${GPU_IDLE_DURATION:-1m}
        labels:
          severity: info
        annotations:
          summary: "GPU Idle on {{ .instance }}"
          description: "GPU load is {{  }}%"
      - alert: HighCPUCoreFrequency
        expr: jetson_cpu_core0_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800} or jetson_cpu_core1_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800} or jetson_cpu_core2_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800} or jetson_cpu_core3_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800} or jetson_cpu_core4_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800} or jetson_cpu_core5_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800} or jetson_cpu_core6_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800} or jetson_cpu_core7_freq_mhz > ${CPU_FREQ_THRESHOLD:-1800}
        for: ${CPU_FREQ_DURATION:-30s}
        labels:
          severity: warning
        annotations:
          summary: "High CPU Core Frequency on {{ .instance }}"
          description: "One of the CPU cores is running above ${CPU_FREQ_THRESHOLD:-1800} MHz (value: {{  }} MHz)"

