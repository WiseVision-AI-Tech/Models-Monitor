global:
  resolve_timeout: 5m
  # SMTP configuration for email notifications
  smtp_from: 'alerts@monitoring.local'
  # Uncomment and configure if using SMTP:
  # smtp_smarthost: '${SMTP_HOST}:${SMTP_PORT}'
  # smtp_auth_username: '${SMTP_USER}'
  # smtp_auth_password: '${SMTP_PASS}'

# Templates for alert formatting
templates:
  - '/etc/alertmanager/templates/*.tmpl'

# Define routes for alert handling
route:
  # Default receiver (required)
  receiver: 'telegram'
  
  # Group alerts by these labels
  group_by: ['alertname', 'cluster', 'service', 'instance']
  
  # How long to wait before sending a notification for a new group
  group_wait: 10s
  
  # How long to wait before resending a notification
  group_interval: 5m
  
  # How long a notification should inhibit further notifications
  repeat_interval: 12h
  
  # Route specific alerts to Telegram
  routes:
    - match:
        alert_type: temperature
      receiver: 'telegram'
      continue: false
    - match:
        alert_type: cpu
      receiver: 'telegram'
      continue: false
    - match:
        alert_type: gpu
      receiver: 'telegram'
      continue: false
    - match:
        alert_type: ram
      receiver: 'telegram'
      continue: false
    # Fallback: send all critical alerts to Telegram
    - match:
        severity: critical
      receiver: 'telegram'

# Receivers define what happens when alerts are triggered
receivers:
  - name: 'null'
    # Null receiver - does nothing (default sink)

  # Telegram webhook receiver
  - name: 'telegram'
    webhook_configs:
      - url: 'http://telegram-webhook:5000/webhook'
        send_resolved: false
        http_config:
          follow_redirects: true
        max_alerts: 10

# Optional: webhook receiver example for custom integrations
# Uncomment to add webhook notifications:
#  - name: 'webhook'
#    webhook_configs:
#      - url: 'http://example.com/alerts'
#        send_resolved: true

# Optional: Slack integration
# Uncomment and configure if using Slack:
#  - name: 'slack'
#    slack_configs:
#      - api_url: '${SLACK_WEBHOOK}'
#        channel: '#alerts'
#        send_resolved: true
#        title: 'Alert: {{ .GroupLabels.alertname }}'
#        text: '{{ range .Alerts }}{{ .Annotations.description }}{{ end }}'

# Inhibit rules to suppress certain alerts
inhibit_rules: []
  # Example: suppress low priority alerts when high priority alerts exist
  # - source_match:
  #     severity: 'critical'
  #   target_match:
  #     severity: 'warning'
  #   equal: ['alertname', 'dev', 'instance']
